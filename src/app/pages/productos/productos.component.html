<div class="card m-4">
  <p-table 
    #dt 
    [value]="(productos$ | async) || []" 
    [loading]="(loading$ | async) || false"
    [lazy]="true"
    (onLazyLoad)="loadProductos($event)"
    [paginator]="true"
    [rows]="5"
    [totalRecords]="(totalCount$ | async) || 0"
    [rowsPerPageOptions]="[5, 10, 20]"
    styleClass="p-datatable-striped"
    responsiveLayout="scroll"
  >
    <ng-template pTemplate="caption">
      <div class="flex justify-content-between align-items-center">
        <h2 class="m-0">Productos</h2>
        <button pButton 
          label="A침adir Producto" 
          aria-label="A침adir Nuevo Producto"
          icon="pi pi-plus" 
          class="p-button-success" 
          (click)="iniciarNuevoProducto()"></button>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>Nombre</th>
        <th>Descripci칩n</th>
        <th>Precio</th>
        <th>Stock</th>
        <th>Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-producto>
      <tr>
        <td>{{ producto.nombre }}</td>
        <td>{{ producto.descripcion }}</td>
        <td>{{ producto.precio | currency:'USD' }}</td>
        <td>{{ producto.stock }}</td>
        <td>
          <button pButton icon="pi pi-pencil" class="p-button-info mr-2" pTooltip="Editar" aria-label="Editar" (click)="editarProducto(producto)"></button>
          <button pButton icon="pi pi-trash" class="p-button-danger" pTooltip="Eliminar" aria-label="Eliminar" (click)="eliminarProducto(producto.id)"></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="5">No se encontraron productos.</td>
        </tr>
    </ng-template>
  </p-table>
</div>

<app-producto-form 
  [(display)]="displayForm" 
  (save)="guardarProducto($event)"
  [categorias]="(categorias$ | async)"
  [producto]="productoSeleccionado">
</app-producto-form>

<p-confirmDialog header="Confirmaci칩n" icon="pi pi-exclamation-triangle"></p-confirmDialog>